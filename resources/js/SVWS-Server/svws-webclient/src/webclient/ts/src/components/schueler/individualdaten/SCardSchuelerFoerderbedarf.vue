<template>
	<svws-ui-content-card title="Sonderpädagogische Förderung">
		<div class="input-wrapper">
			<svws-ui-multi-select
				v-model="inputFoerderschwerpunktID"
				title="Haupt-Förderschwerpunkt"
				:items="inputKatalogFoerderschwerpunkte"
			/>
			<svws-ui-multi-select
				v-model="inputFoerderschwerpunkt2ID"
				title="Weiterer-Förderschwerpunkt"
				:items="inputKatalogFoerderschwerpunkte"
			/>
			<svws-ui-checkbox v-model="inputIstAOSF">AOSF</svws-ui-checkbox>
			<svws-ui-checkbox v-model="inputIstLernenZieldifferent"
				>Zieldifferntes Lernen</svws-ui-checkbox
			>
		</div>
	</svws-ui-content-card>
</template>

<script setup lang="ts">
	import { computed, ComputedRef, WritableComputedRef } from "vue";

	import { KatalogEintrag, SchuelerStammdaten } from "@svws-nrw/svws-core-ts";
	import { injectMainApp, Main } from "~/apps/Main";

	const main: Main = injectMainApp();
	const app = main.apps.schueler;
	const daten: ComputedRef<SchuelerStammdaten> = computed(() => {
		return app.stammdaten.daten || new SchuelerStammdaten();
	});

	const inputKatalogFoerderschwerpunkte: ComputedRef<KatalogEintrag[]> =
		computed(() => app.katalogFoerderschwerpunkte);

	const inputFoerderschwerpunktID: WritableComputedRef<
		KatalogEintrag | undefined
	> = computed({
		get(): KatalogEintrag | undefined {
			const id = daten.value.foerderschwerpunktID;
			return inputKatalogFoerderschwerpunkte.value.find(e => e.id === id);
		},
		set(val: KatalogEintrag | undefined) {
			app.stammdaten.patch({
				foerderschwerpunktID: val?.id
			});
		}
	});

	const inputFoerderschwerpunkt2ID: WritableComputedRef<
		KatalogEintrag | undefined
	> = computed({
		get(): KatalogEintrag | undefined {
			const id = daten.value.foerderschwerpunkt2ID;
			return inputKatalogFoerderschwerpunkte.value.find(e => e.id === id);
		},
		set(val: KatalogEintrag | undefined) {
			app.stammdaten.patch({
				foerderschwerpunkt2ID: val?.id
			});
		}
	});

	const inputIstAOSF: WritableComputedRef<boolean | undefined> = computed({
		get(): boolean {
			return !!daten.value.istAOSF;
		},
		set(val) {
			app.stammdaten.patch({ istAOSF: val });
		}
	});

	const inputIstLernenZieldifferent: WritableComputedRef<
		boolean | undefined
	> = computed({
		get(): boolean {
			return !!daten.value.istLernenZieldifferent;
		},
		set(val) {
			app.stammdaten.patch({ istLernenZieldifferent: val });
		}
	});
</script>
